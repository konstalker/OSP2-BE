name: Telegram Notify on Push

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  telegram:
    runs-on: ubuntu-latest
    steps:
      - name: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞
          COMMIT_MSG="${{ github.head_commit.message }}"
          # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞) –∏ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏)
          COMMIT_TITLE=$(echo "$COMMIT_MSG" | head -n1)
          COMMIT_DESC=$(echo "$COMMIT_MSG" | tail -n +2)

          # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º printf, —á—Ç–æ–±—ã –Ω–∞—Å—Ç–æ—è—â–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –Ω–∞ —Å—Ç—Ä–æ–∫—É —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å
          MESSAGE=$(printf "*%s*\n\n" "$COMMIT_TITLE")
          if [ -n "$COMMIT_DESC" ]; then
            MESSAGE+=$(printf "> %s\n\n" "$COMMIT_DESC")
          fi
          MESSAGE+=$(printf "[zz-osp-pak8.pk3](https://github.com/scoqx/OSP2-BE/releases/download/latest/zz-osp-pak8.pk3)\n")
          MESSAGE+=$(printf "[üí¨ –ß–∞—Ç](https://t.me/q3osp2be_chat)")

          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
          curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" \
            -d text="$MESSAGE" \
            -d parse_mode="Markdown"
